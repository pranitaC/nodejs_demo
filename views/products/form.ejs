<% var url = product.isNew ? "/products" : "/products/"+product._id+"?_method=PUT" %>
<form action="<%= url %>" method="POST" class="form-horizontal"
      enctype="multipart/form-data">

  <div class="form-group">
    <% if(error) { %>
      <label class="control-label">
        <%= error.message %>
    <% } %>
  </div>
  
  <div class="form-group">
    <label class="col-lg-2 control-label">Name:</label>
    <div class="col-lg-8">
      <input type="text" name="product[name]" id="input_name" value="<%= product.name %>" class="form-control"/>
    </div>
  </div>
  
  <div class="form-group">
    <label class="col-lg-2 control-label">Price:</label>
    <div class="col-lg-8">
      <input type="text" name="product[price]" id="input_price" value="<%= product.price %>" class="form-control"/><br/><br/>
    </div>
  </div>
  <div class="form-group">
    <label class="col-lg-2 control-label">Photo:</label>
    <div class="col-lg-8">
      <input type="file" name="photo">
    </div>
  </div>

  <div class="form-group">
    <div class="col-lg-10">
      <input class= "btn btn-lg btn-success pull-right" type="submit" value="<%= product.isNew ? "Create" : "Update" %>"/>
    </div>
  </div>
</form>
<script src="/javascripts/jquery.js"></script>
<script src="/javascripts/jquery_ujs.js"></script>
<script type="text/javascript">
  var price = 0;
  jQuery('.form-submit').on('click', function(e){
    e.preventDefault();
    var isValid = true;
    jQuery(".error").html("");
    if(jQuery("#input_name").val() == "") {
      jQuery(".error").append("<div>Please enter name.</div>");
      isValid = false;
    }
    var priceString = jQuery("#input_price").val();
    if(priceString == "") {
      jQuery(".error").append("<div>Please enter price.</div>");
      isValid = false;
    }
    try{
      price = parseInt(priceString);
      if(isNaN(price)) {
        jQuery(".error").append("<div>Price is invalid.</div>");
        isValid = false;
      } else {
        jQuery("#input_price").val(price);
      }
    } catch(e) {
      jQuery(".error").append("<div>Price is invalid.</div>");
      isValid = false;
    }
    if(isValid) {
      jQuery(".form").submit();
    }
    return true;
  });
</script>
